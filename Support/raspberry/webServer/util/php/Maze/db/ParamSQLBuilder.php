<?php namespace Maze\db;require_once 'common.php';class ParamSQLBuilder{ private $sql; private $params; private $pieces; private $piecesParams; public function __construct($sql,$params){if(isset($params)&&!is_array($params)) throw new \InvalidArgumentException();$this->sql="$sql";$this->params=$params;} public function addSQL($sql,$params){$this->sql.=" $sql";$this->params=safe_array_merge($this->params,$params);} public function addPiece($piece,$params){$this->pieces[]="$piece";$this->piecesParams=safe_array_merge($this->piecesParams,$params);} public function hasPieces(){return isset($this->pieces);} public function concatPieces($separator){if($this->hasPieces()){$this->addSQL(implode(" $separator ",$this->pieces),$this->piecesParams);unset($this->pieces);unset($this->piecesParams);}} public function addRowsCount($rowsCount,$startRow){if(is_int($rowsCount)&&$rowsCount>0){$this->sql.=' limit ?';if(is_int($startRow)&&$startRow>=0){$this->sql.=', ?';$this->params[]=$startRow;}$this->params[]=$rowsCount;}} public function getSQL(){return $this->sql;} public function getParams(){return $this->params;}}
