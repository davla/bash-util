#!/usr/bin/env bash

source /usr/local/lib/manually/lib.sh

shopt -s expand_aliases

REPO_NAME='docker/docker-credential-helpers'
REPO_URL="https://github.com/$REPO_NAME.git"

alias is_installed='[[ -f /usr/local/bin/docker-credential-secretservice ]]'
alias installed-version='_latest-installed-timestamp /usr/local/bin/docker-credential-secretservice'
# shellcheck disable=SC2139
alias latest-version="_latest-git-timestamp \"$REPO_URL\""
alias is-newer='_is-newer-timestamp'
alias remove='rm /usr/local/bin/docker-credential-secretservice'

function install {
    CREDENTIAL_HELPERS_URL="$(latest-release-url \
        'docker/docker-credential-helpers')"
    CREDENTIAL_HELPERS_RELEASE="${CREDENTIAL_HELPERS_URL##*/}"
    CREDENTIAL_HELPERS_URL="$CREDENTIAL_HELPERS_URL/docker-credential-secretservice-$CREDENTIAL_HELPERS_RELEASE-amd64.tar.gz"

    wget -qO - "$CREDENTIAL_HELPERS_URL" | tar x -C /usr/local/bin/
    chmod +x /usr/local/bin/docker-credential-secretservice
}
